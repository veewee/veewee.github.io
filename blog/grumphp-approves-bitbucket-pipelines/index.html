<!DOCTYPE html><html><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge,chrome=1"><title>GrumPHP approves Bitbucket Pipelines!</title><meta name=viewport content="width=device-width, initial-scale=1.0"><link rel=stylesheet href=/css/7fa1.blog.css><!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
    <script src="https://oss.maxcdn.com/libs/respond.js/1.3.0/respond.min.js"></script>
    <![endif]--><link rel=apple-touch-icon-precomposed sizes=144x144 href=/images/apple-touch-icon-144-precomposed.png><link rel="shortcut icon" href=/favicon.ico><link rel=alternate type=application/atom+xml title="Toon Verwerft" href=https://veewee.github.io/atom.xml><meta property=og:description content="Today, my invitation for Bitbucket Pipelines Beta got accepted! For those who haven't heard about it: Pipelines is a Continuous Delivery tool integrated in Bitbucket. When you push your changes to your Bitbucket repository, it will spin up a Docker container and run the actions you specify. I was quite exited about the concept and immediately started to set up an automated test scenario with GrumPHP."><meta property=og:title content="GrumPHP approves Bitbucket Pipelines!"><meta property=og:image content=https://veewee.github.io/20160615/thumb-grumphpipelines.jpg><meta property=og:image:width content=500><meta property=og:image:height content=375><meta name=twitter:card content=summary_large_image><meta name=twitter:site content=@toonverwerft><meta name=twitter:creator content=@toonverwerft></head><body class=bs-docs-home><a class=sr-only href=#content>Skip to main content</a><header class="navbar navbar-inverse navbar-fixed-top bs-docs-nav" role=banner><div class=container><div class=navbar-header><button class=navbar-toggle type=button data-toggle=collapse data-target=.bs-navbar-collapse><span class=sr-only>Toggle navigation</span> <span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></button> <a href="/" class=navbar-brand>Toon Verwerft</a></div><nav class="collapse navbar-collapse bs-navbar-collapse" role=navigation><ul class="nav navbar-nav"><li><a href="/">Home</a></li><li><a href=https://twitter.com/toonverwerft>Twitter</a></li><li><a href="https://github.com/veewee/">Github</a></li><li><a href=https://www.linkedin.com/in/toonverwerft>LinkedIn</a></li><li><a href=https://speakerdeck.com/veewee>Talks</a></li></ul></nav></div></header><a name=#content></a><div id=content><div class=container><div class=row><div class="col-xs-12 col-sm-8 col-md-9 left-pane"><div class=post-details><h1>GrumPHP approves Bitbucket Pipelines!</h1><div class=pull-right><span class="meta label label-info">15 Jun 2016</span></div><small>Tags: <span class="label label-primary tag">php</span> <span class="label label-primary tag">grumphp</span> <span class="label label-primary tag">docker</span></small><div class=post><img src=/images/blog/20160615/grumphpipelines.jpg class=post-banner alt=""><p>Today, my invitation for <a href="https://bitbucket.org/" target=_blank>Bitbucket</a> Pipelines Beta got accepted! For those who haven't heard about it: <a href=https://bitbucket.org/product/features/pipelines target=_blank>Pipelines</a> is a Continuous Delivery tool integrated in Bitbucket. When you push your changes to your Bitbucket repository, it will spin up a <a href="http://docker.io/" target=_blank>Docker</a> container and run the actions you specify. I was quite exited about the concept and immediately started to set up an automated test scenario with <a href=https://github.com/phpro/grumphp target=_blank>GrumPHP</a>.</p><h2>Configuration</h2><p>The configuration of Pipelines is similar to existing services like e.g. <a href="https://travis-ci.org/" target=_blank>Travis</a>. It all starts by adding a <a href=https://confluence.atlassian.com/bitbucket/configure-bitbucket-pipelines-yml-792298910.html target=_blank>bitbucket-pipelines.yml</a> file to the root of your project.</p><p><strong>bitbucket-pipelines.yml:</strong></p><figure class=highlight><pre><code class=language-yaml data-lang=yaml><span></span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span> <span class="l l-Scalar l-Scalar-Plain">php:7.0-cli</span>

<span class="l l-Scalar l-Scalar-Plain">pipelines</span><span class="p p-Indicator">:</span>
  <span class="l l-Scalar l-Scalar-Plain">default</span><span class="p p-Indicator">:</span>
    <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">step</span><span class="p p-Indicator">:</span>
        <span class="l l-Scalar l-Scalar-Plain">script</span><span class="p p-Indicator">:</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">apt-get update &amp;&amp; apt-get install -y git</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">php -r &quot;readfile(&#39;https://getcomposer.org/installer&#39;);&quot; | php</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">php composer.phar global require hirak/prestissimo</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">php composer.phar install --prefer-dist</span>
          <span class="p p-Indicator">-</span> <span class="l l-Scalar l-Scalar-Plain">./vendor/bin/grumphp run</span></code></pre></figure><p>After every commit, the pipelines file will be loaded. Since we've added a default pipeline, it will spin up a basic <a href="https://hub.docker.com/_/php/" target=_blank>PHP 7.0 container</a>. Because it's a basic container, we'll have to install git and composer to make sure the test scenario works. The installation of these packages will happen on every commit, so it is better to create your own container which contains all the tools you need to test your code. Finally, the composer dependencies are installed and the GrumPHP command is being triggered.</p><h2>Analysing the results</h2><p class=text-center><a href=/images/blog/20160615/pipelines-overview.png target=_blank><img src=/images/blog/20160615/pipelines-overview.png alt="GrumPHP Pipelines" class=img-responsive></a></p><p></p><p>As you can see, the Pipelines overview page is very clean and focuses on the output of your tasks. Every commit will trigger a new run and a new results overview page. This makes it very easy to spot problems before they got merged in!</p><h3>Pros</h3><ul><li>It is a unique service that integrates completely on your git server!</li><li>The interface is very simple and focuses on the errors.</li><li>Pipelines is integrated in every screen in Bitbucket. You get feedback about the committed code in a wink of an eye.</li><li>It is possible to let Pipelines handle your Continuous Delivery flow!</li><li>You can specify different steps per git branch.</li><li>It works perfectly fine with GrumPHP!</li><li>It is FREE!</li></ul><h3>Cons</h3><ul><li>The docker image is loaded from <a href=https://hub.docker.com target=_blank>DockerHub</a> which takes a while.</li><li>You can only specify 1 image, which means you cannot test every commit against multiple PHP versions.</li><li>It is not possible to cache the composer packages. All dependencies are downloaded on every commit.</li></ul><h2>Conclusion</h2><p>Bitbucket has done a really great job creating ther unique Pipelines service! Currently it is still in Beta which means they are still working on making it even better. I hope to see some additional features like running tests on multiple images, caching volumes, ... in a near future. In a next phase, I will be playing around with the Continuous Delivery options and maybe link Pipelines with an <a href="https://www.ansible.com/" target=_blank>Ansible</a> script to automatically deploy the changes to a development server.</p></div><a name=comments></a><div id=disqus_thread></div><script type=text/javascript>var disqus_identifier = '/blog/grumphp-approves-bitbucket-pipelines/';
        var disqus_title = 'GrumPHP approves Bitbucket Pipelines!';
        var disqus_url = 'http://veewee.github.io/blog/grumphp-approves-bitbucket-pipelines/';

        // trigger disqus-comments.js
        var embed_disqus_comments = true;</script></div></div><div class="col-xs-12 col-sm-4 col-md-3 right-pane"><h1>whois <small>VeeWee</small></h1><div><img src=/images/picture.png class="img-thumbnail img-responsive selfie" alt=Selfie></div><div><h2>Hi there!</h2><p>Glad you made it to my blog. Please feel free to take a look around. You will find some interesting stuff, mostly about web development and PHP.</p><p>Still can't get enough of me? Quick! Take a look at my <a href=https://speakerdeck.com/veewee>Speakerdeck</a>, <a href=https://twitter.com/toonverwerft>Twitter</a> or <a href="https://github.com/veewee/">Github</a> account.</p></div><div class=list-group><a class=list-group-item href=//github.com/veewee/veewee.github.io/issues/new><span class="glyphicon glyphicon-pencil"></span> Contact Me</a> <a class=list-group-item href=/atom.xml><span class="glyphicon glyphicon-pushpin"></span> Subscribe to RSS</a></div></div></div></div></div><script src=/js/b1a7.vendor.js></script><script src=/js/e51f.blog.js></script></body></html>